<!DOCTYPE HTML>
<html>
<head>
	<meta charset="UTF-8">

	<script type="text/javascript" src="jquery.js"></script>
	<script src="http://localhost:3000/socket.io/socket.io.js"></script>
	<script src="lib-api.js"></script>


	<script type="text/javascript">
	var s = io.connect('http://localhost:3000');
	InitSocket(s, function(){}, function(){});


	$(document).ready(function() {
		$("#user-login").click(function() {
			login($("#input-user-name").val(), $("#input-user-pass").val(), function(data) {
				$("#verify-ret-logs").text("");
				$("#verify-ret-logs").append((data.status ? "TRUE" : "FALSE") + ":" + data.userinfo.name + "@" + data.userinfo.id);

				if (data.status) {
					$("#login-panel").hide();
					$("#second-panel").show();
$("#info").text("");
$("#info").append("ID:" + data.userinfo.name + "<br>");
				}


				$("#input-user-name").val("");
				$("#input-user-pass").val("");
			});
		});
		$("#user-signup").click(function() {
			UserAdd($("#input-user-pass").val(), $("#input-user-name").val(), function(err) {
				if (err) {
					// err
					$("#verify-ret-logs").text("ERROR:Can't add user.[" + err + "]");
					return;
				}

				$("#verify-ret-logs").text("success added new user.");
				$("#input-user-pass").val("");
				$("#input-user-name").val("");
			});
		});


		$("#update-user-geo").click(function() {
			// 位置情報の更新
			updateUserInfo({ lat : $("#input-user-lat").val(), lng : $("#input-user-lng").val() }, function (){
$("#info").append("[GEO UPDATE]:" + $("#input-user-lat").val() + "," + $("#input-user-lng").val() + "<br>");

				$("#input-user-lat").val("");
				$("#input-user-lng").val("");
			});
		});


		$("#set-beacon").click(function() {
			putBeacon(0, function() {
				var tmp = getUserInfo();
$("#info").append("[SET BEACON]:" + tmp.lat + "," + tmp.lng + "<br>");
			});
		});
		$("#get-my-beacons").click(function() {
			getMyBeacons(function(beacons) {
				for (var i = 0; i < beacons.length; ++i) {
$("#info").append("[MY BEACON]:" + beacons[i].beaconId + "(" + beacons[i].lat + "," + beacons[i].lng + ")<br>");
				}
			});
		});
		$("#get-near-beacons").click(function() {
			getNearBeacons(function(beacons) {
				for (var i = 0; i < beacons.length; ++i) {
$("#info").append("[NEAR BEACON]:" + beacons[i].beaconId + "(" + beacons[i].lat + "," + beacons[i].lng + ")<br>");
				}
			});
		});

		$("#remove-beacon").click(function() {
			removeBeacon($("#input-remove-beacon-id").val(), function(err) {
				if (err) {
$("#info").append("[ERROR RMOVE BEACON]:" + $("#input-remove-beacon-id").val() + ":" + err + "<br>");
					return;
				}

$("#info").append("[RMOVE BEACON]:" + $("#input-remove-beacon-id").val() + "<br>");
				$("#input-remove-beacon-id").val("");
			});
		});
	});
	</script>


	<style>
	.panel {
	border-width:	2px;
	border-style:	dotted;
	}
	</style>
	<title>API Server Client Sample</title>
</head>

<body>
	<h1>API Server Client Sample</h1>
	<div id="info" class="panel" style="color:red; font-size:24px;">未ログイン</div>

	<div id="login-panel" class="panel">
		<h2>1.LOGIN / SIGNUP</h2>
		NAME:<input type="text" id="input-user-name"><br>
		PASS:<input type="text" id="input-user-pass"><br>
		<button id="user-login">LOGIN</button><br>
		<button id="user-signup">SINGUP</button>
		<div id="verify-ret-logs"></div>
	</div>

	<div id="second-panel" class="panel" style="display:none;">
		<h2>2.Beacon / Userinfo</h2>
		<div class="panel">
			<h3>User Geo</h3>
			Lat:<input type="text" id="input-user-lat"><br>
			Lng:<input type="text" id="input-user-lng"><br>
			<button id="update-user-geo">Update</button>
		</div>
		<div class="panel">
			<h3>Beacon</h3>
			<button id="set-beacon">Set</button>|
			<button id="get-near-beacons">GetNearBeacons</button>
			<hr>
			BeaconId:<input type="text" id="input-remove-beacon-id"><br>
			<button id="remove-beacon">Remove ( your seted beacon only. )</button><br>
			<hr>
			<button id="get-my-beacons">GetMyBeacons</button>
		</div>
	</div>
</body>
</html>
