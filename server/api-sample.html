<!DOCTYPE HTML>
<html>
<head>
	<meta charset="UTF-8">

	<script type="text/javascript" src="jquery.js"></script>
	<script src="http://localhost:3000/socket.io/socket.io.js"></script>
	<script src="lib-api.js"></script>


	<script type="text/javascript">
	var s = io.connect('http://localhost:3000');
	InitSocket(s, function(){}, function(){});


	s.on("get-db-ret", function (data) {
		console.log("get-db-ret");
		console.log(data.db);

		$("#db-logs").text("");
		if (data.db.length == 0) {
			$("#db-logs").text("no button.");
		}

		for(var i=0; i< data.db.length; ++i) {
			$("#db-logs").append(
				"Beacon:" + i + " : BeaconId = " + data.db[i].beaconId + " @ User Id = " + data.db[i].userId + "<br>" +
				"lat:" + data.db[i].lat + "<br>" +
				"lng:" + data.db[i].lng + "<br>" +
				"timestamp:" + data.db[i].timestamp + "<br>"
			);
		}

		$("#db-logs").append("<br>");
	});


	$(document).ready(function() {
		$("#get-db").click(function () {
			s.emit("get-db", {});
		});

		$("#set-beacon").click(function() {
			updateUserInfo({ lat : $("#input-set-beacon-lat").val(), lng : $("#input-set-beacon-lng").val() }, function (){
				putBeacon(0, function() {
					$("#input-set-beacon-lat").val("");
					$("#input-set-beacon-lng").val("");
				});
			});
		});
		$("#get-beacon").click(function() {
			updateUserInfo({ lat : $("#input-get-beacon-lat").val(), lng : $("#input-get-beacon-lng").val() }, function(){
				getNearBeacons(function (beacons) {
					$("#get-ret-logs").text("");
					if (beacons.length == 0) {
						$("#get-ret-logs").text("no beacons.");
					}

					for(var i=0; i< beacons.length; ++i) {
						$("#get-ret-logs").append(
							"Beacon:" + i + " : BeaconId = " + beacons[i].beaconId + " @ User Id = " + beacons[i].userId + "<br>" +
							"lat:" + beacons[i].lat + "<br>" +
							"lng:" + beacons[i].lng + "<br>" +
							"timestamp:" + beacons[i].timestamp + "<br>"
						);
					}

					$("#get-ret-logs").append("<br>");

					$("#input-get-beacon-lat").val("");
					$("#input-get-beacon-lng").val("");
				});
			});
		});
	});
	</script>


	<title>Server Client Sample</title>
</head>

<body>
	<h1>Client</h1>
	<button id="get-db">Get database.</button>
	<div id="db-logs">LOGS</div>
	<hr>
	<h2>Set Beacon</h2>
	Lat:<input type="text" id="input-set-beacon-lat"><br>
	Lng:<input type="text" id="input-set-beacon-lng"><br>
	<button id="set-beacon">SetBeacon</button>
	<hr>
	<h2>Get Beacon</h2>
	Lat:<input type="text" id="input-get-beacon-lat"><br>
	Lng:<input type="text" id="input-get-beacon-lng"><br>
	<button id="get-beacon">GetBeacon</button>
	<div id="get-ret-logs"></div>
	<hr>
	<h2>Search Beacon</h2>
	Id:<input type="text" id="input-search-beacon-id"><br>
	<button id="search-beacon">SearchBeacon</button>
	<div id="search-ret-logs"></div>
</body>
</html>
